# fklast
final
以下为yml配置
server:
  port: 8083
spring:
  data:
    mongodb:
      uri: mongodb://localhost/fklast
  datasource:
    druid:
      driver-class-name: com.mysql.cj.jdbc.Driver
      url: jdbc:mysql://localhost:3306/fklast?serverTimezone=UTC
      username: "root"
      password: "root"
  profiles:
    active: dev
  mail:
    username: 邮箱账号
    password: 你的秘钥
    default-encoding: UTF-8
    host: smtp.qq.com
  servlet:
    multipart:
      #      单个文件大小
      max-file-size: 1500MB
      #      总上传文件大小
      max-request-size: 3000MB
      #      文件达到多少时进行磁盘写入
      file-size-threshold: 4000MB
      enabled: false
  redis:
    host: localhost
    port: 6379
  cache:
    type: redis
    redis:
      time-to-live: 5m
      #      是否开启前缀
      use-key-prefix: true
      key-prefix: sms_

mybatis-plus:
  global-config:
    db-config:
      table-prefix: fk_
      id-type: auto
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
    map-underscore-to-camel-case: false

#公私钥配置
rsa:
  key:
    pubKeyFile: E:\\fuckingkeys\\id_key_rsa.pub
    priKeyFile: E:\\fuckingkeys\\id_key_rsa



fromMail:
  sender: 215368433@qq.com
logging:
  level:
    root: warn
pagehelper:
  helper-dialect: mysql
  reasonable: true
  support-methods-arguments: true


说明






计算机组成原理培训学习
平台的设计

用
户
手
册

 
计算机组成原理培训学习平台的设计详细介绍
一、软件简介
本系统是基于SpringBoot框架开发的计算机组成原理培训学习平台。实现了发布视频、发布习题、管理员审核、视频播放、习题练习、视频进度的保存和学习进度保存等功能。尤其是实现了视频进度保存和个人学习进度的保存，可以让学生们明确的知道自己学到具体哪一步，并能更好的针对自己的学习展开下一步计划。系统达到了看视频学习，并且做习题练习的目的，可以拓宽学生们学习计算机组成原理课程的渠道，多一种学习方式。学生对较难的知识点有充足的时间可以学习，也能提升学生学习本课程的自主性和积极性。
二、总体设计
1、	系统概述
本系统是基于Java语言开发的Web项目，Intellij IDEA平台会提供系统开发的技术支持，与此同时开发者可根据用户的需求进行开发和维护。系统利用SpringBoot框架的优势特点，为学习者提供在线视频学习、习题练习等服务，解决学习者学习计算机组成原理课程难度较大的问题。学习者可随时查看当前所学习到的个人进度以及视频和习题的详细信息。
2、	开发环境
系统的开发环境是Microsoft Windows 10，其开发软件是Intellij IDEA，数据库是使用MySQL、MongoDB、Redis。各个版本的具体信息如表2-1所示：
表2-1 系统开发环境
开发环境	说明	版本信息
系统环境
Java开发环境
数据库环境
缓存数据库	Microsoft Windows10
Intellij IDEA
MySQL、MongoDB
Redis	Windows 10
Intellij IDEA 2022.2.5
5.5、5.0.5
5.0.10
3、	总体功能
系统的主要体现在于在线视频的学习和习题练习，主要功能包括习题组模块、视频模块。
视频模块包括：
1)	上传视频模块：提供一个视频上传的接口，给用户上传，在上传成功之后会自动截取视频封面。
2)	查询视频模块：可以让用户查询具体的视频信息。
3)	视频播放量记录：可以记录视频的播放次数。
4)	视频进度保存：在用户登录的状态下，可以保存用户当前观看的视频进度，方便下次观看时直接跳到对应位置。
习题模块主要包括：
1)	上传习题：用户可以自行制作选择题、判断题和主观题，题目数量和难度由用户自主掌握，内有保存功能。
2)	查找习题：可以让用户按习题标题查询习题。
3)	已完成的习题记录：在个人主页中，可以提供一个已完成的习题记录列表，里面是已经完成过的习题。
主要功能结构如图2-1所示：
 
图 2 1 主要功能结构图

4、	运行环境
	本软件仅限Web网页端使用。
	使用方式：浏览器的URL中输入http://localhost:3005/html/index.html即可进入首页
	在开始程序之前，需要提前打开MongoDB和Node.js环境。
三、环境部署
1、	开发环境部署
在线下载JDK，版本17。在DOS窗口输入”java -version“然后点击回车键，出现图3-1所示的信息表示运行环境部署成功。

 
图3-1 开发环境部署
2、	配置Java的环境变量
在DOS窗口输入 “javac”然后点击回车键，出现图3-2所示的信息表示开发环境变量配置成功。

图3-2 开发环境配置

3、	配置Node环境变量
在DOS窗口输入 “node”然后点击回车键，出现图3-3所示的信息表示开发环境变量配置成功。

图 3 3 node环境配置

4、	启动MongoDB数据库，在对应数据库路径下的文件夹中开启DOS窗口并且输入“mongod --dbpath=..\data\db”后，出现如图3-4所示信息表示开启成功


 
图 3 4 启动MongoDB数据库
5、	启动前端静态资源访问端口，配置文件app.js内容如下。在对应路径下启动DOS窗口并且输入“node app.js”回车之后，出现如图3-5所示信息表示开启成功
const express = require("express");
const app = express();
const PORT = 3005;

//开放静态资源以供访问
app.use(express.static('static'));

app.listen(PORT, () => {
  console.log(`running at port ${PORT}...`);
})

图 3-5 启动前端静态资源端口
四、详细操作说明
1、	系统首页
	首页主要展示一些基本的计算机组成原理课程的轮播图，课程介绍，课程目标等，其中还有一些推荐视频放到首页内展示，侧边栏有快速访问的按钮，如图4-1所示。

图4-1 系统首页
2、	用户注册
在注册功能中，密码填写需要8-20位英文或数字，邮箱和密码在输入完后，前端会有一个校验，判断邮箱格式和密码的格式，若格式不合格，前端会提示修正。当点击发送验证码按钮时，按钮进入倒计时，倒计时未结束前无法再次发送，同时前端将未注册的用户邮箱发往后端，后端中的Spring Security经过配置，不拦截本次请求。
后端接口接收到邮件之后会生成一个验证码，并且将邮箱为键、验证码为值放入Redis缓存之中，并且设置一定的过期时间，将验证码封装到一封邮件之中，以邮件的形式发送到用户的邮箱之中。
用户将从邮箱中获取的验证码，输入到注册表单中，并且点击注册按钮时，前端将表单数据封装成JSON格式，后端接收后首先校验验证码，然后校验昵称和邮箱是否被注册，最后注册成功。此时用户密码将会被Spring Security的passwordEncoder.encode方法加密保存到数据库。注册功能如图4-2所示。

图4-2 用户注册
3、	系统登录
本系统采用邮箱作为账号登录，在输入完邮箱和密码点击登录之后，前端将登录表单数组化，然后转化成JSON（JavaScriptObject Notation）格式，封装完成后发送Ajax（Asynchronous JavaScript and XML）请求，请求发到后端被JwtLoginFilter过滤器拦截，使用Spring Security框架对用户的邮箱和密码进行登录校验，通过认证之后，则使用Jwt工具包生成一个token给前端使用。登录成功之后会跳转到首页，若是失败则会提示登陆失败。若密码错误，则返回HTTP的401状态码（访问凭据无效）和返回用户名或密码错误的提示。
图4-3 登录
4、	视频列表
当点击视频总览时，将会跳转到视频展示页面，每一页中含有20个视频整齐排列，其中主要内容为计算机组成原理的一些学习视频。页面最上方为查询功能，可以按视频标题、视频简介和上传视频用户名查询。
后端查询出视频信息之后封装到一个DTO（Data Transfer Object）对象中，再放入一个map中，返回当前页码，总页码，总条数，以及所有的视频等如图4-4所示

图4-4 视频列表

5、	视频播放页面
当进入到视频播放页面时，前端首先从URL中提取出视频编号id，后端在接收到请求之后，根据视频id进行查找，将视频信息经过封装之后发回前端。与之同时前端发送增加视频播放量的请求到后端，后端则提升对应的视频播放量。
前端收到视频信息之后，使用ckplayer工具初始化播放器，并且将视频作者、视频分区、视频播放量、视频标题、视频简介显示到前端。
如果用户处于登录状态，则会在用户播放视频的过程中，每过几秒，前端将会通过ckplayer工具获取到用户当前视频进度发到后端。通过验证后会将视频进度添加或者更新到MongoDB中的视频进度表。
如果视频观看结束，前端将会往后端中个人学习进度的模块发送请求，后端在校验token之后，将认定此视频已被用户学习完毕，将会添加到个人学习进度的记录中，页面如图4-5所示

图4-5 视频播放

6、	习题列表
前端发送查询请求之后，首先会查看搜索框中是否有查询习题的搜索。后端接到请求之后，将会把已经审核通过的习题按时间倒序的方式排列发到前端展示，如果有搜索关键词，则会根据习题组标题、课程来查询，将习题信息进行封装，最后发到前端，页面如图4-6所示。

图4-6 习题列表

7、	习题功能
在习题页面中，将会具体的展示所有题目的内容，其中后端会根据前端发来的习题id去查找具体的内容，根据习题组中的题目信息去查找，将其中的选择题、判断题和主观题全部查询出来并且统一封装发到前端
另外，习题界面还可以直接查看答案，答案按钮放在每道题对应的地方，里面有出题人撰写的答案和答案解析。
若用户点击提交按钮，则会携带token向后端请求，校验成功之后，将会在用户的个人学习进度中保留已完成本习题记录，页面如图4-7所示。

图4-7 习题

8、	视频上传功能
视频在选择文件之后就同步上传。视频文件上传使用了Webuploader文件分片上传工具，还可以做到断点续传的功能。
在选择视频文件之后，前端将会同步上传视频文件，通过WebUploader工具将视频文件分成多个小文件，多个线程同时发送到后端，并且对视频格式进行了一定限制，在视频上传之前，还会先检验用户的token是否过期，以确保用户处于登录状态。
后端在接收到一个个分片小文件时，先开辟一个临时目录进行初步存储，并且获取当前分片数和总分片数，在临时目录中对每个分片小文件进行标号。
在最后一个分片文件发送时，后端生成一个缓冲输出流，将需要保存的文件目标目录放入缓冲输出流中，并开始遍历每一个分片，如果文件不存在，则等待文件存在为止，将每个分片小文件转化成byte数组，此时缓冲输出流将byte数据写入到最终目标文件中。
最后文件组合成功时，调用截取视频封面方法，通过FFmpegFrameGrabber的方法截取视频的某一帧为作为视频封面。所有信息整合完毕将信息发回前端。
前端则会将视频封面放到对应位置，剩余信息由用户填写好后，提交即可保存成功如图中所示。后端将会把视频的访问地址和用户填写的信息经过基本设置后保存到视频数据库中，上传文件成功页面如图4-8所示。

图4-8 视频上传
9、	添加习题功能
在添加习题组的页面中，可以记录用户上传的习题组名字、课程名字、以及各类习题等。用户在点击发布时，需要确保用户是在线状态，若是处于未登录，将会跳转到登录页面重新登录。
当每个添加按钮被点击时，对应的题目开始计数，并且记录用户所填内容，例如选择题，其中当填完内容时，需要及时点击保存按钮以防丢失，其他题目类似。首次点击会新增一条记录到数据库，但在重复点击在后端会持续的更新对应题目的所填内容。在填完所有题目点击发布时，前端会整合所有题目信息，将信息打包发送到后端进行解析，后端会根据id集合判断题目是否存在，随后将习题组保存到数据库中，选择题的添加如图4-9所示。 

图4-9 习题上传
10、	个人主页功能
第一部分主要展示用户的基本信息，如邮箱、性别、身份、用户名等内容。以下为查询个人看过的视频的部分代码，其中使用了分页插件的帮助。在点击关于这个按钮时，会将个人邮箱、性别、身份等一些基本信息显示。
本部分展示该用户所学过的视频，有看过的记录都会放在个人主页之中。通过本功能，可以更好的了解到学到哪一步，并且对自己的下一步学习有一个更好、更清晰的判断。习题部分也是同理，已完成的习题将会放在个人主页的记录中，个人视频记录如图4-10所示。


图4-10 个人视频进度
11、	管理员功能
一进入到管理员页面首先是视频审核页面，这里可以看到所有刚上传的视频，其中若是要进行具体审核，可以点击视频编号，页面将会跳转到视频的具体播放页面，管理员可以对视频内容进行查看。此页面中，将视频审核的一些基本信息都有所展示。本界面同样拥有查询和分页功能，管理视频页面如图4-11所示。
图4-11 管理视频页面

当审核完成之后，管理员可以点击修改按钮，此时会跳出来一个弹窗，管理员可以更改视频的审核状态，若是想让视频能正常的在首页展示，则需要审核通过才可以，如图4-11所示

图4-11 修改视频信息

