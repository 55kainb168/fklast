<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="ie=edge" http-equiv="X-UA-Compatible">
    <title>供应商信息总览</title>
    <link href="../css/common.css" rel="stylesheet" type="text/css">
    <link href="../css/search.css" rel="stylesheet">
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/iconfont.css" rel="stylesheet">
    <script src="../js/jquery-3.3.1.js"></script>
    <script src="../js/getParameter.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <!--    让下一页框框变大-->
    <style>
        #pageNum li.page {
            width: 68px;
        }

        .container {
            display: none;
        }

        #insert_container {
            display: none;
        }

        * {
            padding: 0;
            margin: 0;
            text-decoration: none;
        }

        .shell {
            width: 75px;
            height: 435px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background-color: rgb(17, 24, 39);
            border-radius: 5px;
            transition: .3s;
            overflow: hidden;
        }

        .box {
            display: block;
            height: 15%;
            width: 85%;
            margin: 9px;
            border-radius: 5px;
            position: relative;
            transition: .3s;
            color: rgb(160, 160, 175);
        }

        .box i {
            font-size: 30px;
            position: absolute;
            margin: 7px 0 0 13px;
        }

        .box:nth-child(1)::before,
        .box:nth-child(5)::before {
            content: '';
            display: block;
            width: 100%;
            height: 2px;
            background-color: rgb(55, 65, 81);
            position: absolute;
            bottom: -20px;
        }

        .box span {
            position: relative;
            top: 15px;
            left: 65px;
            font: 500 15px '';
            opacity: 0;
            transition: .1s;
        }

        .shell:hover {
            width: 270px;
        }

        .box:hover {
            background-color: rgb(55, 65, 81);
        }

        .shell:hover span {
            opacity: 1;
        }

        .box:hover {
            color: #fff;
        }
    </style>
    <script>
        // 查询一个
        $(function () {
            var cid = getParameter("cid");
            var mname = getParameter("mname");
            if (mname) {
                mname = window.decodeURIComponent(mname);
            }

            load(cid, null, mname)
        });

        //分页查询功能
        function load(cid, currentPage, mname) {
            //发送ajax请求，请求route/pageQuery,传递cid

            $.get("supplier/pageQuery", {cid: cid, currentPage: currentPage, mname: mname}, function (pb) {
                //解析PageBean数据，展示到页面上
                if (mname) {
                    //1.分页工具条数据展示
                    //1.1 展示总页码和总记录数
                    $("#totalPage").html(pb.totalPage);
                    $("#totalCount").html(pb.totalCount);


                    var lis = "";
                    var firstPage = '<li onclick="javascript:load(' + cid + ',1,\'' + mname + '\')"><a href="javascript:void(0)">首页</a></li>';
                    //计算上一页页码
                    var beforeNum = pb.currentPage - 1;
                    if (beforeNum <= 0) {
                        beforeNum = 1;
                    }
                    var beforePage = '<li onclick="javascript:load(' + cid + ',' + beforeNum + ',\'' + mname + '\')" className="threeword"><a>上一页</a></li>';
                    lis += firstPage;
                    lis += beforePage;
                    //1.2 展示分页页码
                    /*
                    *   1.一共展示10个页码,能够达到前5后4的效果
                    *   2.如果前面不够5个，后边补齐10个
                    *   3.如果后边不足4个，前边补齐10个
                    * */

                    //定义开始位置begin，结束为止end
                    var begin;
                    var end;

                    //1.要显示十个页码
                    if (pb.totalPage < 10) {
                        //总页码不够十页
                        begin = 1;
                        end = pb.totalPage;
                    } else {
                        //总页码超过10页
                        begin = pb.currentPage - 5;
                        end = pb.currentPage + 4;
                        //如果前面不够5个，后边补齐10个
                        if (begin < 1) {
                            begin = 1;
                            end = 10;
                        }
                        //如果后边不足4个，前边补齐10个
                        if (end > pb.totalPage) {
                            end = pb.totalPage;
                            begin = end - 9;
                        }
                    }
                    for (i = begin; i <= end; i++) {
                        var li;
                        //判断当前页码时候等于i
                        if (pb.currentPage == i) {
                            var li = '<li class="curPage" onclick="javascript:load(' + cid + ',' + i + ',\'' + mname + '\')"><a href="javascript:void(0)">' + i + '</a></li>';

                        } else {
                            //创建一个页码的li
                            li = '<li onclick="javascript:load(' + cid + ',' + i + ',\'' + mname + '\')"><a href="javascript:void(0)">' + i + '</a></li>';
                        }
                        //拼接字符串
                        lis += li;
                    }


                    //将lis内容设置到ul
                    var lastPage = '<li onclick="javascript:load(' + cid + ',' + pb.totalPage + ',\'' + mname + '\')"><a href="javascript:void(0)">末页</a></li>';

                    var nextNum = pb.currentPage + 1;
                    if (nextNum >= pb.totalPage) {
                        nextNum = pb.totalPage;
                    }
                    var nextPage = '<li onclick="javascript:load(' + cid + ',' + nextNum + ',\'' + mname + '\')" className="threeword"><a href="javascript:;">下一页</a></li>';

                    lis += nextPage;
                    lis += lastPage;
                    $("#pageNum").html(lis);


                    var ris = '                <tr class="success" id="" style="white-space: nowrap">\n' +
                        '                    <th>供应商编号</th>\n' +
                        '                    <th>供应商名称</th>\n' +
                        '                    <th>地址</th>\n' +
                        '                    <th>电话</th>\n' +
                        '                    <th>操作</th>\n' +
                        '                </tr>\n';

                    for (let i = 0; i < pb.list.length; i++) {
                        let data = pb.list[i]
                        let ri = ' <tr>\n' +
                            '<td>' + data.sno + '</td>\n' +
                            '<td>' + data.sname + '</td>\n' +
                            '<td>' + data.saddress + '</td>\n' +
                            '<td>' + data.sphone + '</td>\n' +
                            '<td><a class="btn btn-default btn-sm update" href="#" id="update' + data.sno + '">修改</a>&nbsp;<a\n' +
                            '    class="btn btn-default btn-sm delete" href="" id="' + data.sno + '">删除</a></td>\n' +
                            '</tr>'
                        ris += ri;
                    }
                    ris += '<tr>\n' +
                        '<td align="center" colspan="8"><a class="btn btn-primary insert" href="#">添加供应商信息</a></td>\n' +
                        '</tr>'
                    $("table").html("<tbody>" + ris + "</tbody>");
                    //权限
                    $.get("client/findOne", {}, function (data) {
                        if (data == null) {
                            $(".delete").addClass("disabled")
                            $(".insert").addClass("disabled")
                            $(".update").addClass("disabled")
                        } else {
                            if (data.id == "顾客") {
                                $(".delete").addClass("disabled")
                                $(".insert").addClass("disabled")
                                $(".update").addClass("disabled")
                            } else if (data.id == "销售人员") {
                                $(".delete").addClass("disabled")
                                // $(".insert").addClass("disabled")
                                $(".update").addClass("disabled")

                            } else if (data.id == "采购人员") {
                            }

                        }
                    })
                    //修改功能
                    for (let i = begin; i <= end; i++) {
                        if (pb.currentPage == i) {
                            for (let j = 0; j < pb.list.length; j++) {
                                // console.log(pb.list[j])
                                $("#update" + pb.list[j].sno).click(function () {

                                    $(".page_one").css("display", "none");
                                    $("#container").css("display", "block");

                                    $("#m_mno").val(pb.list[j].sno)
                                    $("#name").val(pb.list[j].sname)
                                    $("#efficacy").val(pb.list[j].saddress)
                                    $("#m_cost").val(pb.list[j].sphone)


                                    //返回
                                    $("#button").click(function () {
                                        location.href = "menu_list1.html?cid=2";
                                    })
                                    $("#submit").click(function () {
                                        console.log($("#updataForm").serialize())
                                        $.post("supplier/updateOne", $("#updataForm").serialize(), function () {
                                        })
                                    })


                                })
                            }

                        }
                    }


                } else {
                    //解析PageBean数据，展示到页面上

                    //1.分页工具条数据展示
                    //1.1 展示总页码和总记录数
                    $("#totalPage").html(pb.totalPage);
                    $("#totalCount").html(pb.totalCount);


                    var lis = "";
                    var firstPage = '<li onclick="javascript:load(' + cid + ',1,' + null + ')"><a  href="javascript:void(0)">首页</a></li>';
                    //计算上一页页码
                    var beforeNum = pb.currentPage - 1;
                    if (beforeNum <= 0) {
                        beforeNum = 1;
                    }
                    var beforePage = '<li class="page" onclick="javascript:load(' + cid + ',' + beforeNum + ',' + null + ')" className="threeword"><a>上一页</a></li>';
                    lis += firstPage;
                    lis += beforePage;
                    //1.2 展示分页页码
                    /*
                    *   1.一共展示10个页码,能够达到前5后4的效果
                    *   2.如果前面不够5个，后边补齐10个
                    *   3.如果后边不足4个，前边补齐10个
                    * */

                    //定义开始位置begin，结束为止end
                    var begin;
                    var end;

                    //1.要显示十个页码
                    if (pb.totalPage < 10) {
                        //总页码不够十页
                        begin = 1;
                        end = pb.totalPage;
                    } else {
                        //总页码超过10页
                        begin = pb.currentPage - 5;
                        end = pb.currentPage + 4;
                        //如果前面不够5个，后边补齐10个
                        if (begin < 1) {
                            begin = 1;
                            end = 10;
                        }
                        //如果后边不足4个，前边补齐10个
                        if (end > pb.totalPage) {
                            end = pb.totalPage;
                            begin = end - 9;
                        }
                    }
                    for (i = begin; i <= end; i++) {
                        var li;
                        //判断当前页码时候等于i
                        if (pb.currentPage == i) {
                            var li = '<li class="curPage" onclick="javascript:load(' + cid + ',' + i + ',' + null + ')"><a href="javascript:void(0)">' + i + '</a></li>';

                        } else {
                            //创建一个页码的li
                            li = '<li onclick="javascript:load(' + cid + ',' + i + ',' + null + ')"><a href="javascript:void(0)">' + i + '</a></li>';
                        }
                        //拼接字符串
                        lis += li;
                    }


                    //将lis内容设置到ul
                    var lastPage = '<li onclick="javascript:load(' + cid + ',' + pb.totalPage + ',' + null + ')"><a href="javascript:void(0)">末页</a></li>';

                    var nextNum = pb.currentPage + 1;
                    if (nextNum >= pb.totalPage) {
                        nextNum = pb.totalPage;
                    }
                    var nextPage = '<li class="page" onclick="javascript:load(' + cid + ',' + nextNum + ',' + null + ')" className="threeword"><a href="javascript:void(0);">下一页</a></li>';

                    lis += nextPage;
                    lis += lastPage;
                    $("#pageNum").html(lis);

                    var ris = '                <tr class="success" id="" style="white-space: nowrap">\n' +
                        '                    <th>供应商编号</th>\n' +
                        '                    <th>供应商名称</th>\n' +
                        '                    <th>地址</th>\n' +
                        '                    <th>电话</th>\n' +
                        '                    <th>操作</th>\n' +
                        '                </tr>\n';

                    for (let i = 0; i < pb.list.length; i++) {
                        let data = pb.list[i]
                        let ri = ' <tr>\n' +
                            '<td>' + data.sno + '</td>\n' +
                            '<td>' + data.sname + '</td>\n' +
                            '<td>' + data.saddress + '</td>\n' +
                            '<td>' + data.sphone + '</td>\n' +
                            '<td><a class="btn btn-default btn-sm update" href="#" id="update' + data.sno + '">修改</a>&nbsp;<a\n' +
                            '    class="btn btn-default btn-sm delete" href="" id="' + data.sno + '">删除</a></td>\n' +
                            '</tr>'
                        ris += ri;
                    }
                    ris += '<tr>\n' +
                        '<td align="center" colspan="8"><a class="btn btn-primary insert" id="insert" href="#">添加供应商信息</a></td>\n' +
                        '</tr>'
                    $("table").html("<tbody>" + ris + "</tbody>");

                    //权限
                    $.get("client/findOne", {}, function (data) {
                        if (data == null) {
                            $(".delete").addClass("disabled")
                            $(".insert").addClass("disabled")
                            $(".update").addClass("disabled")
                        } else {
                            if (data.id == "顾客") {
                                $(".delete").addClass("disabled")
                                $(".insert").addClass("disabled")
                                $(".update").addClass("disabled")
                            } else if (data.id == "销售人员") {
                            } else if (data.id == "采购人员") {
                            }
                        }
                    })
                    //修改功能
                    for (let i = begin; i <= end; i++) {
                        if (pb.currentPage == i) {
                            for (let j = 0; j < pb.list.length; j++) {
                                $("#update" + pb.list[j].sno).click(function () {

                                    $(".page_one").css("display", "none");
                                    $("#container").css("display", "block");

                                    $("#m_mno").val(pb.list[j].sno)
                                    $("#name").val(pb.list[j].sname)
                                    $("#efficacy").val(pb.list[j].saddress)
                                    $("#m_cost").val(pb.list[j].sphone)
                                    //返回
                                    $("#button").click(function () {
                                        location.href = "menu_list1.html?cid=2";
                                    })
                                    $("#submit").click(function () {
                                        $.post("supplier/updateOne", $("#updataForm").serialize(), function () {
                                        })
                                    })


                                })
                            }

                        }
                    }
                }
                // //定位到页面的顶部
                // window.scrollTo(0, 0);

                //增加功能
                $(".insert").click(function () {
                    $(".page_one").css("display", "none");
                    $("#insert_container").css("display", "block");
                    //返回
                    $("#m_button").click(function () {
                        location.href = "menu_list1.html?cid=2";
                    })
                    $("#m_submit").click(function () {
                        $.post("supplier/insert", $("#insertForm").serialize(), function (data) {
                        })
                    })
                })

                //删除功能
                $(".delete").click(function () {
                    var sno = this.id;
                    // 访问路径
                    for (let i = 0; i < pb.list.length; i++) {
                        if (sno == pb.list[i].sno) {
                            if (confirm("是否真的删除:" + pb.list[i].sname + "，供应商编号为：" + pb.list[i].sno + " 的记录")) {
                                $.post("supplier/delOne", {sno: sno}, function (data) {

                                });
                            }
                        }
                    }

                })
            })
        }


    </script>


</head>
<body>
<!--引入头部-->
<div id="header"></div>
<div class="page_one">
    <div class="shell" style="position: fixed;top:180px;">
        <a class="box" href="#"><i class="iconfont icon-caidan"></i><span>菜单</span></a>
        <a class="box" href="index.html"><i class="iconfont icon-shouye"></i><span>首页</span></a>
        <a class="box" href="menu_list0.html"><i class="iconfont icon-yaopinshuju"></i><span>药品大全</span></a>
        <a class="box" href="menu_list1.html"><i class="iconfont icon-gongyingshang"></i><span>供应商大全</span></a>
        <a class="box" href="menu_list2.html"><i class="iconfont icon-jiaoyijilu"></i><span>交易记录</span></a>
        <a class="box" href="menu_list3.html"><i class="iconfont icon-pifajia"></i><span>进货记录</span></a>
        <a class="box" href="faq.html"><i class="iconfont icon-icon-"></i><span>使用说明</span></a>
    </div>
    <div class="contant">
        <div class="crumbs">
            <img alt="" src="../images/search.png">
            <p>供应商总览><span>搜索结果</span></p>
        </div>
        <div class="xinxi clearfix">
            <table border="1" class="table table-bordered table-hover">
                <tr class="success" id="" style="white-space: nowrap">
                    <th>供应商编号</th>
                    <th>供应商名称</th>
                    <th>地址</th>
                    <th>电话</th>
                </tr>
            </table>

        </div>
    </div>

    <div style="display: flex;justify-content: center;font-size: 25px">
        <div class="page_num_inf">
            <i></i> 共
            <span id="totalPage"></span>页<span id="totalCount"></span>条
        </div>
    </div>


    <div class="pageNum" style="display: flex;justify-content: center">
        <ul id="pageNum">
            <li><a href="">首页</a></li>
            <li class="threeword"><a href="#">上一页</a></li>
            <li><a href="#">1</a></li>
            <li><a href="#">2</a></li>
            <li><a href="#">3</a></li>
            <li><a href="#">4</a></li>
            <li><a href="#">5</a></li>
            <li><a href="#">6</a></li>
            <li><a href="#">7</a></li>
            <li><a href="#">8</a></li>
            <li><a href="#">9</a></li>
            <li><a href="#">10</a></li>
            <li class="threeword"><a href="javascript:;">下一页</a></li>
            <li class="threeword"><a href="javascript:;">末页</a></li>
        </ul>
    </div>
</div>
<div class="container" id="container" style="width: 600px;">
    <h3 style="text-align: center;">修改供应商信息</h3>
    <form action="" id="updataForm" method="post">
        <div class="form-group">
            <label for="m_mno">供应商编号：</label>
            <input class="form-control" id="m_mno" name="sno" readonly="readonly" required type="text"/>
        </div>
        <div class="form-group">
            <label for="name">供应商名字：</label>
            <input class="form-control" id="name" name="sname" placeholder="请输入供应商名字" required type="text"/>
        </div>

        <div class="form-group">
            <label for="efficacy">地址：</label>
            <input class="form-control" id="efficacy" name="saddress" placeholder="请输入地址" required type="text"/>
        </div>

        <div class="form-group">
            <label for="m_cost">电话：</label>
            <input class="form-control" id="m_cost" name="sphone" placeholder="请输入电话" required type="text"/>
        </div>

        <div class="form-group" style="text-align: center">
            <input class="btn btn-primary" id="submit" type="submit" value="提交"/>
            <input class="btn btn-default" id="button" type="button" value="返回"/>
        </div>
    </form>
</div>
<div class="container" id="insert_container" style="width: 600px;">
    <h3 style="text-align: center;">新增供应商信息</h3>
    <form action="" id="insertForm" method="post">
        <div class="form-group">
            <label for="mmname">供应商名字：</label>
            <input class="form-control" id="mmname" name="sname" placeholder="请输入供应商名字" required type="text"/>
        </div>

        <div class="form-group">
            <label for="efficacy">地址：</label>
            <input class="form-control" id="mmefficacy" name="saddress" placeholder="请输入地址" required type="text"/>
        </div>

        <div class="form-group">
            <label for="mm_cost">电话：</label>
            <input class="form-control" id="mm_cost" name="sphone" placeholder="请输入电话" required type="text"/>
        </div>

        <div class="form-group" style="text-align: center">
            <input class="btn btn-primary" id="m_submit" type="submit" value="提交"/>
            <input class="btn btn-default" id="m_button" type="button" value="返回"/>
        </div>
    </form>
</div>
<!--引入头部-->
<div id="footer"></div>
<!--导入布局js，共享header和footer-->
<script src="../js/include.js" type="text/javascript"></script>
<script>

</script>
</body>

</html>